<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于Github Action构建Flutter应用 | MetaverseK Blog</title>
    <meta name="description" content="github actions demo for flutter">
    
    <meta name="keywords" content="flutter, github actions">
    <link rel="preload" href="/assets/css/0.styles.afb273fd.css" as="style"><link rel="preload" href="/assets/js/app.bff1ae47.js" as="script"><link rel="preload" href="/assets/js/8.2552ec62.js" as="script"><link rel="preload" href="/assets/js/3.fdc44ecf.js" as="script"><link rel="preload" href="/assets/js/16.0fe6bd49.js" as="script"><link rel="preload" href="/assets/js/19.b0634fec.js" as="script"><link rel="preload" href="/assets/js/13.ff535b01.js" as="script"><link rel="preload" href="/assets/js/28.88b42902.js" as="script"><link rel="preload" href="/assets/js/5.1f9b2f0f.js" as="script"><link rel="prefetch" href="/assets/js/10.9b0caa1e.js"><link rel="prefetch" href="/assets/js/11.05c0f8df.js"><link rel="prefetch" href="/assets/js/12.ef4b26b9.js"><link rel="prefetch" href="/assets/js/14.fed400be.js"><link rel="prefetch" href="/assets/js/15.af0149f6.js"><link rel="prefetch" href="/assets/js/17.facb2d84.js"><link rel="prefetch" href="/assets/js/18.7027da36.js"><link rel="prefetch" href="/assets/js/20.8f9eade5.js"><link rel="prefetch" href="/assets/js/21.f8616e1b.js"><link rel="prefetch" href="/assets/js/22.62a4ef07.js"><link rel="prefetch" href="/assets/js/23.740b98a9.js"><link rel="prefetch" href="/assets/js/24.4ce3a297.js"><link rel="prefetch" href="/assets/js/25.13f603ae.js"><link rel="prefetch" href="/assets/js/26.6aca1c89.js"><link rel="prefetch" href="/assets/js/27.10ee73d0.js"><link rel="prefetch" href="/assets/js/29.c72a1fbd.js"><link rel="prefetch" href="/assets/js/30.660cb13f.js"><link rel="prefetch" href="/assets/js/4.489587f2.js"><link rel="prefetch" href="/assets/js/6.20e8a23c.js"><link rel="prefetch" href="/assets/js/7.4e79809a.js"><link rel="prefetch" href="/assets/js/9.51d87dfa.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.4eefb3a3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.afb273fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">
        MetaverseK Blog
      </span></a> <nav class="nav-links can-hide"><ul class="nav-ul"><li class="nav-item"><a href="/" class="nav-link">首页</a></li><li class="nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="nav-item"><a href="/about/" class="nav-link">关于我</a></li><li class="nav-item"><a href="https://github.com/handoing" target="_blank" rel="noopener noreferrer" class="nav-link">GITHUB</a></li></ul></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <!----> <div class="layout-container"><div class="main"><div class="layout-inner"><div class="card"><div class="content-header"><h1 class="page-title">基于Github Action构建Flutter应用</h1> <span class="page-timestamp">2019-10-12</span></div> <div class="content__default"><h2 id="_1-github-actions是什么？"><a href="#_1-github-actions是什么？" aria-hidden="true" class="header-anchor">#</a> 1.GitHub Actions是什么？</h2> <p>GitHub Actions是Github的持续集成服务，类似于Jenkins、Travis CI之类的工具，帮助开发者从Github构建、测试和部署代码，我们可以通过Github的事件机制（push等）启动workflow。</p> <p>actions类似于脚本文件，帮助开发者构建workflow，我们可以通过Github的<a href="https://github.com/marketplace?type=actions" target="_blank" rel="noopener noreferrer">Marketplace<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查找他人贡献的actions，也可以根据自己项目自定义actions。</p> <p>actions不仅可以用于构建和部署，还可以做其他事情，因为它就是跑在docker容器中的脚本，想做什么取决于你自己。</p> <p>目前GitHub Actions还没有全面开放，需要我们去<a href="https://github.com/features/actions/signup" target="_blank" rel="noopener noreferrer">申请<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，等待官方审核通过，大约需要几天的时间，审核通过会收到通知，同时你会看到项目里多了一个Actions的tab。</p> <p><img src="/github_action_flutter_demo/i1.png" alt="Actions"></p> <h2 id="_2-通过github-actions构建flutter的android应用"><a href="#_2-通过github-actions构建flutter的android应用" aria-hidden="true" class="header-anchor">#</a> 2.通过GitHub Actions构建Flutter的Android应用</h2> <p>首先创建一个flutter应用，我拿Android Studio默认创建的flutter项目为例，提交到github仓库（<a href="https://github.com/handoing/github_action_flutter_demo" target="_blank" rel="noopener noreferrer">https://github.com/handoing/github_action_flutter_demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p> <p>进入Actions如图：</p> <p><img src="/github_action_flutter_demo/i2.png" alt="Actions"></p> <p>目前我们还没有创建workflow，可以直接在项目本地创建一个<code>.github/workflows</code>目录并创建build.ymal文件，把文件提交到github仓库，或直接通过github创建一个workflow，这里我们直接通过github创建workflow，点击Set up a workflow yourself，并编写yaml文件。
关于如何编写yaml这里不做介绍，大家可以直接看<a href="https://help.github.com/en/articles/workflow-syntax-for-github-actions" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>如图：</p> <p><img src="/github_action_flutter_demo/i3.png" alt="workflow"></p> <p>修改build.yaml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> CI

<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Test on $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.os <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.os <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
      <span class="token key atrule">matrix</span><span class="token punctuation">:</span>
        <span class="token key atrule">os</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ubuntu<span class="token punctuation">-</span>latest<span class="token punctuation">]</span>
        <span class="token comment"># os: [ubuntu-latest, windows-latest, macos-latest]</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v1
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>java@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">java-version</span><span class="token punctuation">:</span> <span class="token string">'12.x'</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> subosito/flutter<span class="token punctuation">-</span>action@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">flutter-version</span><span class="token punctuation">:</span> <span class="token string">'1.9.1+hotfix.4'</span>
          <span class="token key atrule">channel</span><span class="token punctuation">:</span> <span class="token string">'stable'</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> flutter build apk
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> upload artifects
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/upload<span class="token punctuation">-</span>artifact@master
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> flutter<span class="token punctuation">-</span>android<span class="token punctuation">-</span>demo
          <span class="token key atrule">path</span><span class="token punctuation">:</span> build/app/outputs/apk/release
</code></pre></div><p>这里解释下build.yaml文件执行步骤：</p> <ul><li>我们创建了一个名为CI的workflow</li> <li>当push代码时会触发jobs</li> <li>创建一个test的job，设置了name及runs-on，这里用到了matrix里定义的os，目前我们只使用了ubuntu系统，我们还可以添加多个操作系统</li> <li>通过actions/checkout拉取我们代码</li> <li>通过actions/setup-java构建java环境</li> <li>通过subosito/flutter-action构建flutter环境</li> <li>通过actions/upload-artifact打包我们的指定路径的文件夹上传到artifects</li></ul> <p>点击Start commit提交commit，此时会触发workflow构建，我们接着点击项目Actions会看到对应workflow正在构建，如图：</p> <p><img src="/github_action_flutter_demo/i4.png" alt="workflow"></p> <p>点击CI可以查看对应的构建步骤及日志信息，如图：</p> <p><img src="/github_action_flutter_demo/i5.png" alt="workflow"></p> <p>当workflow执行完毕后我们可以通过点击右上角的Artifacts下载我们上传的编译产物，如图：</p> <p><img src="/github_action_flutter_demo/i6.png" alt="workflow"></p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>Github Actions适用于Github上大部分开源项目，避免了依赖Travis CI或Circle CI等第三方CI/CD工具，给开发者提供了便利的workflow，但目前Github Actions还处于测试阶段，期待后续开放。</p></div> <div class="content page-nav"><p class="inner"><span class="prev">←
          <a href="/blog/growth_topic.html" class="prev">📝这是一个关于成长的话题</a></span> <!----></p></div></div> <!----></div> <div class="tool-group"><!----></div></div></div> <footer class="footer"><span>钢铁般的回忆对你说句爱你三千遍</span></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.bff1ae47.js" defer></script><script src="/assets/js/8.2552ec62.js" defer></script><script src="/assets/js/3.fdc44ecf.js" defer></script><script src="/assets/js/16.0fe6bd49.js" defer></script><script src="/assets/js/19.b0634fec.js" defer></script><script src="/assets/js/13.ff535b01.js" defer></script><script src="/assets/js/28.88b42902.js" defer></script><script src="/assets/js/5.1f9b2f0f.js" defer></script>
  </body>
</html>
